#INCLUDE "PROTHEUS.CH"

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁGPEXTMP   Ё Autor ЁMauricio T. Takakura   Ё Data Ё10/08/2005Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁRotina para atualizacao do Template para o Mexico           Ё
цддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё 		ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.			  	Ё
цддддддддддддбддддддддбддддддбдддддддддддддддддддддддддддддддддддддддддд╢
ЁProgramador Ё Data	  Ё BOPS Ё  Motivo da Alteracao			  		  	Ё
цддддддддддддеддддддддеддддддедддддддддддддддддддддддддддддддддддддддддд╢
ЁMauricio T. Ё10/08/05Ё------ЁCriacao do Programa.                 	  	Ё
юддддддддддддаддддддддаддддддадддддддддддддддддддддддддддддддддддддддддды/*/
Function GPEXTMP()

Local aArea			:= GetArea()

Local bBtnOK
Local bDialogInit

Local oDlg
Local oBtnOk

Begin Sequence

	cCadastro := "Filtrar as Tabelas para Template do Mexico"
	
	bDialogInit := { || NIL } 
	DEFINE MSDIALOG oDlg TITLE cCadastro FROM 010.2,023.3 TO 027.4,87.3 OF GetWndDefault() STYLE DS_MODALFRAME

		/*
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Descricao da Janela                                                      Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды */
		@ 11,12 TO 100,245 OF oDlg PIXEL

		bBtnOk		:= { || BarGerTmp() }

		TButton():New(110,212, "&"+OemToAnsi("Cancelar")	, , { || oDlg:End() } , 032, 012 ,,,,.T.)			// "Cancelar"
		oBtnOk := TButton():New(110,175, "&"+OemToAnsi("OK")	, , bBtnOK , 032, 012 ,,,,.T.)					// "OK"
		
	ACTIVATE DIALOG oDlg ON INIT Eval( bDialogInit ) CENTERED

End Sequence

RestArea( aArea )

Return( Nil )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁBarGerTmp Ё Autor ЁMauricio T. Takakura   Ё Data Ё10/08/2005Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁSelecionar o diretorio com as tabelas                       Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function BarGerTmp()

Local bBase

Local cPath

bBase  	:= { || cPath := cGetFile( "" , "Selecione o Diretorio" , 0 , NIL , .F. , GETF_RETDIRECTORY ) }

Eval( bBase ) 
		
Proc2BarGauge( { || GerarTmpl( cPath ) } , OemToAnsi( "Alterando as Tabelas" ) , NIL , NIL , .F. , .T. , .F. , .F. )

Return( Nil )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁGerarTmpl Ё Autor ЁMauricio T. Takakura   Ё Data Ё10/08/2005Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁFiltar apenas os registros da folha                         Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function GerarTmpl( cPath )

Local cArq

Local cTimeIni	:= Time()

Local nQtde		:= 11

//aAdd( aTabelas, { "SIX", "SX1", "SX2", "SX3", "SX5", "SX6", "SX7", "SX9", "SXA", "SXB", "SXG" } )

BarGauge1Set( 11 )

Begin Sequence

	If Empty(cPath)
		MsgInfo( "Diretorio nao selecionado!", "Alerta" )
		Break
	EndIf

	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX1 - Tabela de Perguntas                 Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX1.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS1",.F.,.F.)
	DbGoTop()
	
	While XS1->( !Eof() )
		If Substr( X1_GRUPO, 1, 2) != "GP" .and. !( Substr( X1_GRUPO, 1, 6) $ "IMPREC/PEREDI/PNM040")
			RecLock( "XS1" , .F. )
			XS1->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX2 - Tabela de Arquivos                  Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX2.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS2",.F.,.F.)
	DbGoTop()
	
	While XS2->( !Eof() )
		If Substr( X2_CHAVE, 1, 2) != "SR" .and. Substr( X2_CHAVE, 1, 2) != "RC" .and. Substr( X2_CHAVE, 1, 2) != "RG" .and.;
			Substr( X2_CHAVE, 1, 3) != "VAM" .and. Substr( X2_CHAVE, 1, 3) != "AI8"
			RecLock( "XS2" , .F. )
			XS2->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK

	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SIX - Tabela de Indices                   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SIX.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XSI",.F.,.F.)
	DbGoTop()
	
	While XSI->( !Eof() )
		If Substr( INDICE, 1, 2) != "SR" .and. Substr( INDICE, 1, 2) != "RC" .and. Substr( INDICE, 1, 2) != "RG" .and. ;
			Substr( INDICE, 1, 3) != "VAM" .and. Substr( X2_CHAVE, 1, 3) != "AI8"
			RecLock( "XSI" , .F. )
			XSI->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX3 - Tabela de Campos                    Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX3.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS3",.F.,.F.)
	DbGoTop()
	
	While XS3->( !Eof() )
		If Substr( X3_ARQUIVO, 1, 2) != "SR" .and. Substr( X3_ARQUIVO, 1, 2) != "RC"  .and. Substr( X3_ARQUIVO, 1, 3) != "VAM" ;
			.and. Substr( X3_ARQUIVO, 1,2) != "RG" .and. Substr( X2_CHAVE, 1, 3) != "AI8"
			RecLock( "XS3" , .F. )
			XS3->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX5 - Tabela de Consulta                  Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX5.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS5",.F.,.F.)
	DbGoTop()
	
	While XS5->( !Eof() )
		If !( XS5->X5_TABELA $ "27/41" )
			RecLock( "XS5" , .F. )
			XS5->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX6 - Tabela de Parametros                Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX6.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS6",.F.,.F.)
	DbGoTop()
	
	While XS6->( !Eof() )
		If !( XS6->X6_VAR $ "MV_FALSUA /MV_CATNPGT/MV_EDIDIRE/MV_EDILOG /MV_EDIDIRR/MV_MODFOL/MV_DIASAPR/ " )
			RecLock( "XS6" , .F. )
			XS6->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX7 - Tabela de Gatilhos                  Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX7.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS7",.F.,.F.)
	DbGoTop()
	
	While XS7->( !Eof() )
		If !( Substr( XS7->X7_CAMPO, 1, 1) == "R" .and. Substr( XS7->X7_CAMPO, 3, 1) == "_" ) .and. ;
		   !( Substr( XS7->X7_CAMPO, 1, 2) == "RC" ) .and. !( Substr( XS7->X7_CAMPO, 1, 2) == "RG" )
		   
			RecLock( "XS7" , .F. )
			XS7->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK

	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SX9 - Tabela de Relacionamentos           Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SX9.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XS9",.F.,.F.)
	DbGoTop()
	
	While XS9->( !Eof() )
		If !( Substr( XS9->X9_DOM, 1, 2) $ "SR/RC/RG" ) .and. ;
		   !( Substr( XS9->X9_CDOM, 1, 2) $ "SR/RC/RG" )
			RecLock( "XS9" , .F. )
			XS9->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK

	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SXA - Tabela de Pastas                    Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SXA.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XSA",.F.,.F.)
	DbGoTop()
	
	While XSA->( !Eof() )
		If !( Substr( XSA->XA_ALIAS, 1, 2) $ "SR/RC/RG" )
			RecLock( "XSA" , .F. )
			XSA->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK
	
	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SXB - Tabela de Consulta Padrao           Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SXB.DBF"
	
	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XSB",.F.,.F.)
	DbGoTop()
                         
	While XSB->( !Eof() )
		If !( Substr( XSB->XB_ALIAS, 1, 2) $ "SR/RC/S0/RG" ) .and. !( Substr( XSB->XB_ALIAS, 1, 3) $ "CAD/X06/LAY/VAM/SQ3/AI8" ) .and. !( Substr( XSB->XB_ALIAS, 1, 6) $ "X61MEX" ) .and. !( Substr( XSB->XB_ALIAS, 1, 5) $ "RHVAM" )
			RecLock( "XSB" , .F. )                                                                                                                                   
			XSB->( dbDelete() )
			MsUnLock()
		EndIf
		DbSkip()
	EndDo
	PACK

	/*
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Filtro da Tabela SXG - 						             Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
	cArq := cPath + "SXG.DBF"

	IncPrcG1Time( "Filtrando o Arquivo: " +  cArq , nQtde , cTimeIni , .T. , 1 , 1 , .T. )

	dbUseArea(.T.,"dbfcdxads",cArq,"XSG",.F.,.F.)
	DbGoTop()

	While XSG->( !Eof() )
		RecLock( "XSG" , .F. )
		XSG->( dbDelete() )
		MsUnLock()
		DbSkip()
	EndDo
	PACK

End Sequence

Return( Nil )
